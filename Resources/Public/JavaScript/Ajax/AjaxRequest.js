/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
var __awaiter=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,a)}c((r=r.apply(t,e||[])).next())}))};define(["require","exports","../BackwardCompat/JQueryNativePromises","./AjaxResponse","./ResponseError"],(function(t,e,n,r,s){"use strict";class o{constructor(t){this.queryArguments="",this.url=t,this.abortController=new AbortController,n.default.support()}static transformToFormData(t){const e=(t,n="")=>Object.keys(t).reduce((r,s)=>{const o=n.length?n+"[":"",i=n.length?"]":"";return"object"==typeof t[s]?Object.assign(r,e(t[s],o+s+i)):r[o+s+i]=t[s],r},{}),n=e(t),r=new FormData;for(const[t,e]of Object.entries(n))r.set(t,e);return r}static createQueryString(t,e){return"string"==typeof t?t:t instanceof Array?t.join("&"):Object.keys(t).map(n=>{let r=e?`${e}[${n}]`:n,s=t[n];return"object"==typeof s?o.createQueryString(s,r):`${r}=${encodeURIComponent(`${s}`)}`}).join("&")}withQueryArguments(t){const e=this.clone();return e.queryArguments=(""!==e.queryArguments?"&":"")+o.createQueryString(t),e}get(t={}){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.send(Object.assign(Object.assign({},{method:"GET"}),t));return new r.AjaxResponse(e)}))}post(t,e={}){return __awaiter(this,void 0,void 0,(function*(){const n={body:o.transformToFormData(t),cache:"no-cache",method:"POST"},s=yield this.send(Object.assign(Object.assign({},n),e));return new r.AjaxResponse(s)}))}put(t,e={}){return __awaiter(this,void 0,void 0,(function*(){const n={body:o.transformToFormData(t),cache:"no-cache",method:"PUT"},s=yield this.send(Object.assign(Object.assign({},n),e));return new r.AjaxResponse(s)}))}delete(t={},e={}){return __awaiter(this,void 0,void 0,(function*(){const n={cache:"no-cache",method:"DELETE"};"object"==typeof t&&Object.keys(t).length>0&&(n.body=o.transformToFormData(t));const s=yield this.send(Object.assign(Object.assign({},n),e));return new r.AjaxResponse(s)}))}getAbort(){return this.abortController}clone(){return Object.assign(Object.create(this),this)}send(t={}){return __awaiter(this,void 0,void 0,(function*(){let e=new URL(this.url).toString();if(""!==this.queryArguments){e+=(this.url.includes("?")?"&":"?")+this.queryArguments}const n=yield fetch(e,this.getMergedOptions(t));if(!n.ok)throw new s.ResponseError(n);return n}))}getMergedOptions(t){return Object.assign(Object.assign(Object.assign({},o.defaultOptions),t),{signal:this.abortController.signal})}}return o.defaultOptions={credentials:"same-origin"},o}));