/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
var __awaiter=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(a,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,r)}c((n=n.apply(e,t||[])).next())}))};define(["require","exports","TYPO3/CMS/Core/Ajax/AjaxRequest"],(function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),describe("TYPO3/CMS/Core/Ajax/AjaxRequest",()=>{let e;beforeEach(()=>{const t=new Promise((t,o)=>{e={resolve:t,reject:o}});spyOn(window,"fetch").and.returnValue(t)}),it("sends GET request",()=>{new o("https://example.com").get(),expect(window.fetch).toHaveBeenCalledWith("https://example.com/",jasmine.objectContaining({method:"GET"}))}),it("sends POST request",()=>{const e=new FormData;e.set("foo","bar"),e.set("bar","baz"),e.set("nested[works]","yes"),new o("https://example.com").post({foo:"bar",bar:"baz",nested:{works:"yes"}}),expect(window.fetch).toHaveBeenCalledWith("https://example.com/",jasmine.objectContaining({method:"POST",body:e}))}),it("sends PUT request",()=>{new o("https://example.com").put({}),expect(window.fetch).toHaveBeenCalledWith("https://example.com/",jasmine.objectContaining({method:"PUT"}))}),it("sends DELETE request",()=>{new o("https://example.com").delete(),expect(window.fetch).toHaveBeenCalledWith("https://example.com/",jasmine.objectContaining({method:"DELETE"}))}),describe("send GET requests",()=>{for(let t of function*(){yield["plaintext","foobar huselpusel",{},(e,t)=>{expect("string"==typeof e).toBeTruthy(),expect(e).toEqual(t),expect(window.fetch).toHaveBeenCalledWith(jasmine.any(String),jasmine.objectContaining({method:"GET"}))}],yield["JSON",JSON.stringify({foo:"bar",baz:"bencer"}),{"Content-Type":"application/json"},(e,t)=>{expect("object"==typeof e).toBeTruthy(),expect(JSON.stringify(e)).toEqual(t),expect(window.fetch).toHaveBeenCalledWith(jasmine.any(String),jasmine.objectContaining({method:"GET"}))}],yield["JSON with utf-8",JSON.stringify({foo:"bar",baz:"bencer"}),{"Content-Type":"application/json; charset=utf-8"},(e,t)=>{expect("object"==typeof e).toBeTruthy(),expect(JSON.stringify(e)).toEqual(t),expect(window.fetch).toHaveBeenCalledWith(jasmine.any(String),jasmine.objectContaining({method:"GET"}))}]}()){let[n,a,i,s]=t;it("receives a "+n+" response",t=>{const n=new Response(a,{headers:i});e.resolve(n),new o("https://example.com").get().then(e=>__awaiter(void 0,void 0,void 0,(function*(){const o=yield e.resolve();s(o,a),t()})))})}}),describe("send requests with query arguments",()=>{for(let e of function*(){yield["single level of arguments",{foo:"bar",bar:"baz"},"https://example.com/?foo=bar&bar=baz"],yield["nested arguments",{foo:"bar",bar:{baz:"bencer"}},"https://example.com/?foo=bar&bar[baz]=bencer"],yield["string argument","hello=world&foo=bar","https://example.com/?hello=world&foo=bar"],yield["array of arguments",["foo=bar","husel=pusel"],"https://example.com/?foo=bar&husel=pusel"]}()){let[t,n,a]=e;it("with "+t,()=>{new o("https://example.com").withQueryArguments(n).get(),expect(window.fetch).toHaveBeenCalledWith(a,jasmine.objectContaining({method:"GET"}))})}})})}));